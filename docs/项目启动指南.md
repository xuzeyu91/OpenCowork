# OpenCowork 项目启动指南

本文档说明如何在本地启动 OpenCowork（Electron + React + TypeScript）。

## 1. 环境准备

建议先安装：

- Node.js（建议使用当前 LTS 版本）
- npm（随 Node.js 安装）
- Git

可选检查：

```bash
node -v
npm -v
```

## 2. 获取代码

```bash
git clone <你的仓库地址>
cd OpenCowork
```

## 3. 安装依赖

```bash
npm install
```

说明：项目 `postinstall` 会自动执行 `electron-builder install-app-deps`，属于正常行为。

## 4. 启动开发环境

```bash
npm run dev
```

启动后将进入 Electron 开发模式（含 HMR 热更新）。

## 5. 常用开发命令

```bash
# 渲染进程类型检查
npm run typecheck:web

# 主进程类型检查
npm run typecheck:node

# 全量类型检查
npm run typecheck

# Lint
npm run lint

# 代码格式化
npm run format
```

## 6. 构建与打包

```bash
# 生产构建（含 typecheck）
npm run build

# Windows 打包
npm run build:win

# macOS 打包
npm run build:mac

# Linux 打包
npm run build:linux
```

## 7. 运行生产预览

```bash
npm run start
```

## 8. 首次运行数据目录

应用会在用户目录创建：

- `~/.open-cowork/data.db`
- `~/.open-cowork/settings.json`
- `~/.open-cowork/config.json`
- `~/.open-cowork/agents/`
- `~/.open-cowork/skills/`

## 9. 常见问题排查

### 9.1 `npm install` 失败

- 先删除 `node_modules` 与 `package-lock.json` 后重试：

```bash
rm -rf node_modules package-lock.json
npm install
```

（Windows PowerShell 可用：`Remove-Item -Recurse -Force node_modules; Remove-Item -Force package-lock.json`）

### 9.2 启动时报原生模块相关错误（如 `better-sqlite3`）

- 重新安装依赖：

```bash
npm install
```

- 如仍失败，可单独执行：

```bash
npx electron-builder install-app-deps
```

### 9.3 开发环境正常但打包失败

- 先执行：

```bash
npm run typecheck
npm run build
```

- 再执行目标平台打包命令。

---

如需团队统一环境，建议补充 `.nvmrc` 或 Volta 配置来锁定 Node 版本。